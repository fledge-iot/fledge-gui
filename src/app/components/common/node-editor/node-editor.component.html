<div>
  <div class="navbar-item pb-0">
    <div>
      <nav class="breadcrumb mb-2" aria-label="breadcrumbs">
        <ul>
          <li *ngIf="from=='south'">
            <a [routerLink]="['/flow/editor/south']">South</a>
          </li>
          <li *ngIf="from=='north'">
            <a [routerLink]="['/flow/editor/north']">North</a>
          </li>
          <li *ngIf="from=='notifications'" class="pt-2">
            <a [routerLink]="['/flow/editor/notifications']">Notifications</a>
          </li>
          <li [ngClass]="{'is-active' : !source || !isAddFilterWizard}" *ngIf="source">
            <a [routerLink]="['/flow/editor', from, source, 'details']">
              {{source ? source : 'Add'}}
            </a>
          </li>
          <li class="is-active" *ngIf="source  && isAddFilterWizard">
            <a href="#" aria-current="page">
              Add Filter
            </a>
          </li>
        </ul>
      </nav>
      <ng-container *ngIf="source && !isAddFilterWizard">
        <button type="button" (click)="reload()" class="button is-small" title="Reload" id="refresh-check">
          <i class="fa fa-sm fa-sync" aria-hidden="true"></i>
        </button>
      </ng-container>
    </div>
    <div *ngIf="serviceInfo.isEnabled && serviceInfo.isInstalled && from === 'notifications'">
      <app-service-config (serviceConfigureModal)="openServiceConfigureModal()"></app-service-config>
      <span class="icon is-small tooltip is-pulled-right is-hovered help-pad" data-tooltip="Help"
        (click)="goToLink('using-the-notification-service')">
        <i class="far fa-question-circle"></i>
      </span>
    </div>
    <ng-container *ngIf="source && rolesService.hasEditPermissions() && !isAddFilterWizard">
      <button class="button is-small is-link mb-1" (click)="save()">Save</button>
    </ng-container>
  </div>
  <ng-container *ngIf="from === 'notifications'">
    <app-notification-service-warning [isEnabled]="serviceInfo.isEnabled" [isInstalled]="serviceInfo.isInstalled"
      [isAvailable]="serviceInfo.isAvailable" [serviceName]="serviceInfo.name"
      (serviceConfigureModal)="openServiceConfigureModal()"
      (refreshService)="refreshServiceInfo()"></app-notification-service-warning>
  </ng-container>
  <ng-container *ngIf="!isAddFilterWizard">
    <div class="rete" #rete></div>
  </ng-container>
  <ng-contafiner *ngIf="source && isAddFilterWizard">
    <div class="box animated slideInRight">
      <app-add-filter-wizard (notify)="onNotify($event)" [serviceName]="source" [from]="from"></app-add-filter-wizard>
    </div>
  </ng-contafiner>
  <!-- Quick View -->
  <app-quickview #quickView [showReadings]="showReadings" (closeAction)="closeRightDrawer()">
    <ng-container *ngIf="showPluginConfiguration">
      <app-configuration-group *ngIf="category" [category]="category" [from]="'south'" [sourceName]="serviceName"
        (changedConfigEvent)="getChangedConfig($event)"
        (changedAdvanceConfigEvent)="getChangedAdvanceConfiguration($event)"
        (formStatusEvent)="validConfigurationForm = $event"></app-configuration-group>
      <div class="container is-fluid" *ngIf="category">
        <div class="columns" *ngIf="rolesService.hasEditPermissions()">
          <div class="column">
            <button [disabled]="checkFormState()" [appDisableUntilResponse]="reenableButton"
              class="button is-small is-link ml-4" (click)="saveConfiguration()">Save</button>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="showFilterConfiguration">
      <app-configuration-group *ngIf="filterCategory" [category]="filterCategory" [sourceName]="quickviewFilterName"
        (changedConfigEvent)="getChangedFilterConfig($event)" (formStatusEvent)="validFilterConfigForm = $event">
      </app-configuration-group>
      <div class="container is-fluid" *ngIf="filterCategory">
        <div class="columns" *ngIf="rolesService.hasEditPermissions()">
          <div class="column">
            <button [disabled]="checkFilterFormState()" [appDisableUntilResponse]="reenableButton"
              class="button is-small is-link ml-4" (click)="saveFilterConfiguration()">Save</button>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="showLogs && from !== 'notifications'">
      <app-system-log [sourceName]="serviceName"></app-system-log>
    </ng-container>

    <!-- Notification Log in Quickview -->
    <ng-container *ngIf="showLogs && from === 'notifications'">
      <app-notification-log [sourceName]="serviceName"></app-notification-log>
    </ng-container>

    <!-- Notification Instance Configuration in Quickview -->
    <ng-container *ngIf="showNotificationConfiguration && from === 'notifications'">
      <app-configuration-group #notificationConfigView *ngIf="category" [sourceName]="serviceName" [category]="category"
        [from]="'notifications'" (changedConfigEvent)="getChangedNotificationConfig($event)"
        (formStatusEvent)="validConfigurationForm = $event">
      </app-configuration-group>
      <hr *ngIf="notification != undefined" class="hr-text notification-hr"
        [attr.data-content]="'Rule - ' + notification.rule">
      <div class="columns">
        <div class="column">
          <div class="field">
            <app-configuration-group #ruleConfigView *ngIf="ruleCategory" [sourceName]="serviceName"
              [category]="ruleCategory" [from]="'rule-modal'" (changedConfigEvent)="getChangedRuleConfig($event)"
              (formStatusEvent)="validConfigurationForm = $event">
            </app-configuration-group>
          </div>
        </div>
      </div>
      <hr *ngIf="notification != undefined" class="hr-text notification-hr"
        [attr.data-content]="'Delivery Channel - ' + notification.channel">
      <div class="columns">
        <div class="column">
          <div class="field">
            <app-configuration-group #deliveryConfigView *ngIf="deliveryCategory" [category]="deliveryCategory"
              [sourceName]="serviceName" [from]="'delivery-modal'"
              (changedConfigEvent)="getChangedDeliveryConfig($event)"
              (formStatusEvent)="validConfigurationForm = $event">
            </app-configuration-group>
          </div>
        </div>
      </div>
      <div class="container is-fluid" *ngIf="rolesService.hasEditPermissions()">
        <div class="columns">
          <div class="column">
            <div class="field is-grouped is-pulled-left">
              <p class="control">
                <button class="button is-small is-link ml-4" (click)="saveNotificationConfiguration()"
                  [appDisableUntilResponse]="reenableButton">Save</button>
              </p>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="showTaskSchedule">
      <app-task-schedule [taskSchedule]="taskSchedule"></app-task-schedule>
    </ng-container>
    <ng-container *ngIf="showReadings">
      <app-asset-tracker [service]="readingService" [isAlive]="isAlive" [reenableButton]="reenableButton"
        (selectedAsset)="selectAsset($event)" (reloadReadings)="getSouthservices()"
        (exportReading)="getAssetReadings(readingService)"></app-asset-tracker>
    </ng-container>
  </app-quickview>
</div>

<app-confirmation-dialog id="delete-service-dialog" *ngIf="rolesService.hasEditPermissions()">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">
      {{ task && task?.execution == "task" ? "Delete Task": (from === 'notifications' ? 'Delete Instance' :
      'Delete Service')}}
    </span>
    <button class="delete" aria-label="close" (click)="closeModal('delete-service-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Deleting {{dialogServiceName}} {{ task && task?.execution == "task"? 'task': (from === 'notifications' ? 'instance'
    : 'service')}} cannot be undone. Continue?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('delete-service-dialog')">Cancel</button>
    <button class="button is-small is-danger" (click)="deleteService()"
      [appDisableUntilResponse]="reenableButton">Delete</button>
  </footer>
</app-confirmation-dialog>

<app-confirmation-dialog id="delete-filter-dialog" *ngIf="rolesService.hasEditPermissions()">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">Delete Filter</span>
    <button class="delete" aria-label="close" (click)="closeModal('delete-filter-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Deleting {{filterName}} filter cannot be undone. Continue?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('delete-filter-dialog')">Cancel</button>
    <button class="button is-small is-danger" (click)="deleteFilterFromPipeline()"
      [appDisableUntilResponse]="reenableButton">Delete</button>
  </footer>
</app-confirmation-dialog>
<!-- <app-task-schedule #taskScheduleComponent [taskSchedule]="taskSchedule"></app-task-schedule> -->

<app-confirmation-dialog id="asset-tracking-dialog">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">Deprecate</span>
    <button class="delete" aria-label="close" (click)="closeModal('asset-tracking-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Are you sure, <b>{{selectedAsset}}</b> will be deprecated if this action is continued?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('asset-tracking-dialog')">Cancel</button>
    <button class="button is-small is-danger" (click)="deprecateAsset(selectedAsset)">Yes</button>
  </footer>
</app-confirmation-dialog>

<!--  Unsaved changes dialog  -->
<app-unsaved-changes-dialog (discardChanges)="resetForm()"></app-unsaved-changes-dialog>
<app-confirmation-dialog id="state-change-dialog">
  <header class="modal-card-head">
    <span class="modal-card-title is-size-6">{{btnText}} Instance</span>
    <button class="delete" aria-label="close" (click)="closeModal('state-change-dialog')"></button>
  </header>
  <section class="modal-card-body">
    Are You sure, you want to {{btnText}} the instance {{dialogServiceName}}?
  </section>
  <footer class="modal-card-foot">
    <button class="button is-small" (click)="closeModal('state-change-dialog')">Cancel</button>
    <button class="button is-small" [ngClass]="{'is-danger': btnText === 'Disable', 'is-info': btnText === 'Enable'}"
      (click)="toggleState(btnText)">{{btnText}}</button>
  </footer>
</app-confirmation-dialog>
