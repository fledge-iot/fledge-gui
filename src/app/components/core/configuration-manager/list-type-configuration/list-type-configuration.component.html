<div [formGroup]="listItemsForm">
  <ng-container *ngFor="let item of listItems.controls; let i = index">
    <ng-container *ngIf="configuration.items != 'object'; else objectTemplate">
      <div formArrayName="listItems" class="field">
        <div>
          <div class="columns is-flex is-vcentered">
            <div class="column is-11">
              <ng-container *ngIf="rolesService.hasAccessPermission(configuration?.permissions); else staticView">
                <input *ngIf="configuration.items == 'integer'" class="input is-small" type="text" formControlName="{{i}}"
                  [minValue]="configuration?.minimum" [maxValue]="configuration?.maximum" appIntegerOnly>
                <input *ngIf="configuration.items == 'float'" class="input is-small" type="text" formControlName="{{i}}"
                  [minValue]="configuration?.minimum" [maxValue]="configuration?.maximum" appFloatOnly>
                <input *ngIf="configuration.items == 'string'" class="input is-small" type="text" formControlName="{{i}}"
                  [attr.maxLength]="configuration?.length">
              </ng-container>
              <ng-template #staticView>
                <span class="help">
                  {{listItems?.controls[i]?.value}}
                </span>
              </ng-template>
            </div>
            <div class="column is-1 has-text-right" *ngIf="rolesService.hasAccessPermission(configuration?.permissions)">
              <button class="delete my-1 is-small" (click)="removeListItem(i)"></button>
            </div>
          </div>
        </div>
      </div>
      <div>
        <span *ngIf="listItems?.controls[i]?.hasError('minValue')" class="help is-danger">
          <sup>*</sup>Value should not be less than {{configuration?.minimum}}.
        </span>
        <span *ngIf="listItems?.controls[i]?.hasError('maxValue')" class="help is-danger">
          <sup>*</sup>Value should not be greater than {{configuration?.maximum}}.
        </span>
      </div>
    </ng-container>
    <ng-template #objectTemplate>
      <div class="card mt-0 mb-1 card-shadow">
        <header class="card-header has-background-white card-header-shadow is-justify-content-space-between">
          <div class="card-header-title">
            <p class="subtitle is-size-9" id="card-title-{{configuration.key}}-{{i}}">{{listLabel}}</p>
          </div>
          <button class="card-header-icon" (click)="toggleCard(i)" id="dots-btn-{{configuration.key}}-{{i}}">
            <span class="icon is-small">
              <i class="bi bi-three-dots bi-sm" aria-hidden="true"></i>
            </span>
          </button>
          <button class="card-header-icon" (click)="toggleCard(i)">
            <span class="icon is-small toogle-icon" id="card-span-{{configuration.key}}-{{i}}" title="Expand">
              <i id="card-icon-{{configuration.key}}-{{i}}" class="fas fa-2xs fa-angle-right" aria-hidden="true"></i>
            </span>
          </button>
        </header>
        <div class="card-content is-hidden" id="card-content-{{configuration.key}}-{{i}}">
          <div formArrayName="listItems">
            <div class="columns mb-0">
              <div class="column is-11 px-3 py-1">
                <app-show-configuration [groupConfiguration]="initialProperties[i]"
                  [fullConfiguration]="initialProperties[i]" (event)="getChangedConfiguration(i, $event)"
                  (formStatusEvent)="formStatus($event)" [from]="from" [group]="group"></app-show-configuration>
              </div>
              <div class="column is-1 has-text-right" *ngIf="rolesService.hasAccessPermission(configuration?.permissions)">
                <button class="delete my-1 is-small" (click)="removeListItem(i)"></button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <span *ngIf="listItems?.controls[i]?.hasError('minValue')" class="help is-danger">
            <sup>*</sup>Value should not be less than {{configuration?.minimum}}.
          </span>
          <span *ngIf="listItems?.controls[i]?.hasError('maxValue')" class="help is-danger">
            <sup>*</sup>Value should not be greater than {{configuration?.maximum}}.
          </span>
        </div>
      </div>
    </ng-template>
  </ng-container>
  <div class="field" *ngIf="rolesService.hasAccessPermission(configuration?.permissions)">
    <p class="control" *ngIf="!configuration.listSize || configuration.listSize != listItems.controls.length ">
      <button class="button is-small" (click)="addListItem()"
        [ngClass]="{'px-0 pt-1 is-ghost': configuration.items != 'object', 'mt-1': configuration.items == 'object'}">
        <span class="icon is-small mr-0">
          <i class="bi bi-plus bi-sm"></i>
        </span>
        <span>Add new item</span>
      </button>
    </p>
  </div>
</div>